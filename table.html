<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>熊が出るBMS難易度表</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="bmstable" content="./header.json">

  <link rel="stylesheet" href="style/style.css" type="text/css" media="screen,print">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <center>
    <strong><span style="font-size: 24pt;">熊が出るBMS難易度表[工事中] (読み込みに数秒かかります)</span></strong><br>
    <a href="index.html">TOP</a><br>
  </center>

  <div class="tableflame">
    <table align="center" cellspacing="1" cellpadding="2" border="0" bgcolor="#000000" id="table_int"></table>
  </div>

  <script>
  // メニュー切り替え
  function menu(tName) {
    const tMenu = document.getElementById(tName).style;
    tMenu.display = (tMenu.display === 'none') ? 'block' : 'none';
  }

  $(document).ready(function () {
    const headerPath = $("meta[name=bmstable]").attr("content");
    $.getJSON(headerPath, function (header) {
      $.getJSON(header.data_url, function (information) {
        if (header["level_order"]) {
          makeBMSTable(information, header.symbol, header["level_order"]);
        } else {
          makeBMSTable(information, header.symbol);
        }
      });
    });
  });

  // 難易度表生成
  function makeBMSTable(info, mark, order = null) {
    const obj = $("#table_int");
    obj.html("");

    $("<tr height='20' style='color:white;background-color:#666666'>" +
      "<td align='center'>LV</td><td align='center'>動画</td><td align='center'>譜面</td>" +
      "<td colspan='2' align='center'>beatoraja IR</td>" +
      "<td align='center'>タイトル</td><td align='center'>作者</td>" +
      "<td align='center'>差分</td><td align='center'>コメント</td>" +
    "</tr>").appendTo(obj);

    // ソート処理
    if (order && order.length > 0) {
      // header.jsonのlevel_orderが指定されている場合の処理
      const orderAry = order.map(o => o.toString());
      // orderAryに無いレベル(indexOfが-1)が先頭に来てしまうのを防ぐため、
      // -1の場合は大きな値(Infinity)に置き換えてソートする
      info.forEach(item => {
          let index = orderAry.indexOf(item.level.toString());
          item._index = (index === -1) ? Infinity : index;
      });
      info.sort((a, b) => {
          if (a._index === Infinity && b._index === Infinity) {
              // 両方ともlevel_orderに無い場合は、デフォルトソート
              return defaultSort(a, b);
          }
          return a._index - b._index || a.title.localeCompare(b.title);
      });
      info.forEach(item => delete item._index);

    } else {
      // ▼▼▼ ここからが変更点です (デフォルトソート) ▼▼▼
      // level_order が無い場合のデフォルトソート
      info.sort(defaultSort);

